{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nimport { useRef, useState } from 'react';\nimport { getTargetElement } from '../utils/domTarget';\nimport useEffectWithTarget from '../utils/useEffectWithTarget';\nvar initRect = {\n  top: NaN,\n  left: NaN,\n  bottom: NaN,\n  right: NaN,\n  height: NaN,\n  width: NaN\n};\n\nvar initState = __assign({\n  text: ''\n}, initRect);\n\nfunction getRectFromSelection(selection) {\n  if (!selection) {\n    return initRect;\n  }\n\n  if (selection.rangeCount < 1) {\n    return initRect;\n  }\n\n  var range = selection.getRangeAt(0);\n\n  var _a = range.getBoundingClientRect(),\n      height = _a.height,\n      width = _a.width,\n      top = _a.top,\n      left = _a.left,\n      right = _a.right,\n      bottom = _a.bottom;\n\n  return {\n    height: height,\n    width: width,\n    top: top,\n    left: left,\n    right: right,\n    bottom: bottom\n  };\n}\n\nfunction useTextSelection(target) {\n  var _a = __read(useState(initState), 2),\n      state = _a[0],\n      setState = _a[1];\n\n  var stateRef = useRef(state);\n  stateRef.current = state;\n  useEffectWithTarget(function () {\n    var el = getTargetElement(target, document);\n\n    if (!el) {\n      return;\n    }\n\n    var mouseupHandler = function mouseupHandler() {\n      var selObj = null;\n      var text = '';\n      var rect = initRect;\n      if (!window.getSelection) return;\n      selObj = window.getSelection();\n      text = selObj ? selObj.toString() : '';\n\n      if (text) {\n        rect = getRectFromSelection(selObj);\n        setState(__assign(__assign(__assign({}, state), {\n          text: text\n        }), rect));\n      }\n    }; // 任意点击都需要清空之前的 range\n\n\n    var mousedownHandler = function mousedownHandler() {\n      if (!window.getSelection) return;\n\n      if (stateRef.current.text) {\n        setState(__assign({}, initState));\n      }\n\n      var selObj = window.getSelection();\n      if (!selObj) return;\n      selObj.removeAllRanges();\n    };\n\n    el.addEventListener('mouseup', mouseupHandler);\n    document.addEventListener('mousedown', mousedownHandler);\n    return function () {\n      el.removeEventListener('mouseup', mouseupHandler);\n      document.removeEventListener('mousedown', mousedownHandler);\n    };\n  }, [], target);\n  return state;\n}\n\nexport default useTextSelection;","map":{"version":3,"sources":["E:/wcy/Github/fun-rec/codes/news_recsys/news_rec_web/my-app-ts/node_modules/ahooks/es/useTextSelection/index.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__read","o","m","Symbol","iterator","r","ar","e","next","done","push","value","error","useRef","useState","getTargetElement","useEffectWithTarget","initRect","top","NaN","left","bottom","right","height","width","initState","text","getRectFromSelection","selection","rangeCount","range","getRangeAt","_a","getBoundingClientRect","useTextSelection","target","state","setState","stateRef","current","el","document","mouseupHandler","selObj","rect","window","getSelection","toString","mousedownHandler","removeAllRanges","addEventListener","removeEventListener"],"mappings":"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","sourcesContent":["var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nimport { useRef, useState } from 'react';\nimport { getTargetElement } from '../utils/domTarget';\nimport useEffectWithTarget from '../utils/useEffectWithTarget';\nvar initRect = {\n  top: NaN,\n  left: NaN,\n  bottom: NaN,\n  right: NaN,\n  height: NaN,\n  width: NaN\n};\n\nvar initState = __assign({\n  text: ''\n}, initRect);\n\nfunction getRectFromSelection(selection) {\n  if (!selection) {\n    return initRect;\n  }\n\n  if (selection.rangeCount < 1) {\n    return initRect;\n  }\n\n  var range = selection.getRangeAt(0);\n\n  var _a = range.getBoundingClientRect(),\n      height = _a.height,\n      width = _a.width,\n      top = _a.top,\n      left = _a.left,\n      right = _a.right,\n      bottom = _a.bottom;\n\n  return {\n    height: height,\n    width: width,\n    top: top,\n    left: left,\n    right: right,\n    bottom: bottom\n  };\n}\n\nfunction useTextSelection(target) {\n  var _a = __read(useState(initState), 2),\n      state = _a[0],\n      setState = _a[1];\n\n  var stateRef = useRef(state);\n  stateRef.current = state;\n  useEffectWithTarget(function () {\n    var el = getTargetElement(target, document);\n\n    if (!el) {\n      return;\n    }\n\n    var mouseupHandler = function mouseupHandler() {\n      var selObj = null;\n      var text = '';\n      var rect = initRect;\n      if (!window.getSelection) return;\n      selObj = window.getSelection();\n      text = selObj ? selObj.toString() : '';\n\n      if (text) {\n        rect = getRectFromSelection(selObj);\n        setState(__assign(__assign(__assign({}, state), {\n          text: text\n        }), rect));\n      }\n    }; // 任意点击都需要清空之前的 range\n\n\n    var mousedownHandler = function mousedownHandler() {\n      if (!window.getSelection) return;\n\n      if (stateRef.current.text) {\n        setState(__assign({}, initState));\n      }\n\n      var selObj = window.getSelection();\n      if (!selObj) return;\n      selObj.removeAllRanges();\n    };\n\n    el.addEventListener('mouseup', mouseupHandler);\n    document.addEventListener('mousedown', mousedownHandler);\n    return function () {\n      el.removeEventListener('mouseup', mouseupHandler);\n      document.removeEventListener('mousedown', mousedownHandler);\n    };\n  }, [], target);\n  return state;\n}\n\nexport default useTextSelection;"]},"metadata":{},"sourceType":"module"}