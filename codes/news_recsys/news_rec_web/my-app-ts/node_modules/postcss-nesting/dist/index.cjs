"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var t=e(require("postcss-selector-parser"));function n(e){if(!e.nodes.length)return void e.remove();const t=e.nodes.filter((e=>"comment"===e.type));t.length===e.nodes.length&&e.replaceWith(...t)}function r(e){const t=e.parent,r=t.index(e);if(r){n(t.cloneBefore().removeAll().append(t.nodes.slice(0,r)))}return t.before(e),t}function o(e,t){if(t<2)throw new Error("n must be greater than 1");if(e.length<2)throw new Error("s must be greater than 1");if(Math.pow(e.length,t)>1e4)throw new Error("Too many combinations when trying to resolve a nested selector with lists, reduce the complexity of your selectors");const n=[];for(let e=0;e<t;e++)n[e]=0;const r=[];for(;;){const o=[];for(let s=t-1;s>=0;s--){let t=n[s];if(t>=e.length){if(t=0,n[s]=0,0===s)return r;n[s-1]+=1}o[s]=e[t]}r.push(o),n[n.length-1]++}}const s=t.default.pseudo({value:":is"});function a(e){const t=e.nodes.filter((e=>"tag"===e.type));t.length>1&&t.slice(1).forEach((e=>{const t=s.clone();e.replaceWith(t),t.append(e)}))}function c(e,n){let r=[],o=!1;const s=[...e.nodes];for(let e=0;e<s.length+1;e++){const c=s[e];if(c&&"combinator"!==c.type)"nesting"===c.type&&(o=!0),r.push(c);else{if(o){r=[];continue}if(r.length>1){const e=t.default.selector();r[0].replaceWith(e),r.slice(1).forEach((e=>{e.remove()})),r.forEach((t=>{e.append(t)})),l(e),n&&a(e),e.replaceWith(...e.nodes)}r=[]}}}function l(e){e.nodes.sort(((e,t)=>e.type===t.type?0:i[e.type]<i[t.type]?-1:1))}const i={universal:0,tag:1,id:2,class:3,attribute:4,pseudo:5,selector:7,string:8,root:9,comment:10,nesting:9999};function p(e){const n=e.map((e=>t.default().astSync(e))).map((e=>u(e))),r=n[0];for(let e=1;e<n.length;e++)if(r.a!==n[e].a||r.b!==n[e].b||r.c!==n[e].c)return!1;return!0}function u(e){let n=0,r=0,o=0;if("id"===e.type)n+=1;else if("tag"===e.type)o+=1;else if("class"===e.type)r+=1;else if("attribute"===e.type)r+=1;else if("pseudo"===e.type)switch(e.value){case"::after":case":after":case"::backdrop":case"::before":case":before":case"::cue":case"::cue-region":case"::first-letter":case":first-letter":case"::first-line":case":first-line":case"::file-selector-button":case"::grammar-error":case"::marker":case"::part":case"::placeholder":case"::selection":case"::slotted":case"::spelling-error":case"::target-text":o+=1;break;case":is":case":has":case":not":if(e.nodes&&e.nodes.length>0){let t={a:0,b:0,c:0};e.nodes.forEach((e=>{const n=u(e);n.a>t.a?t=n:n.a<t.a||(n.b>t.b?t=n:n.b<t.b||n.c>t.c&&(t=n))})),n+=t.a,r+=t.b,o+=t.c}break;case"where":break;case":nth-child":case":nth-last-child":{const s=e.nodes.findIndex((e=>{e.value}));if(s>-1){const a=u(t.default.selector({nodes:e.nodes.slice(s+1)}));n+=a.a,r+=a.b,o+=a.c}else n+=n,r+=r,o+=o}break;default:r+=1}else e.nodes&&e.nodes.length>0&&e.nodes.forEach((e=>{const t=u(e);n+=t.a,r+=t.b,o+=t.c}));return{a:n,b:r,c:o}}function d(e,n,r){let s=[];s=p(e)||r.noIsPseudoSelector?e.map((e=>t.default().astSync(e))):[t.default().astSync(`:is(${e.join(",")})`)];let i=[];for(let e=0;e<n.length;e++){const p=n[e];let u=1,d=[],g=0;if(t.default().astSync(p).walkNesting((()=>{g++})),g>1&&s.length>1)d=o(s,g),u=d.length;else{u=s.length;for(let e=0;e<s.length;e++){d.push([]);for(let t=0;t<g;t++)d[e].push(s[e])}}for(let e=0;e<u;e++){let n=0;const o=t.default().astSync(p);o.walk((o=>{if("nesting"!==o.type)return;let s=d[e][n];n++,"root"===s.type&&1===s.nodes.length&&(s=s.nodes[0]);const i=t.default().astSync(`:is(${s.toString()})`),p=f(s.nodes[0]),u=h(s.nodes[0]),g=f(o),b=h(o);if(p&&g)return void o.replaceWith(s.clone());if((p||u)&&(g||b)){const e=o.parent;return p&&"selector"===s.type?o.replaceWith(s.clone().nodes[0]):o.replaceWith(...s.clone().nodes),void(e&&e.nodes.length>1&&(l(e),r.noIsPseudoSelector||a(e)))}if(p){const e=o.parent;return o.replaceWith(s.clone().nodes[0]),void(e&&c(e,!r.noIsPseudoSelector))}if(u){const e=o.parent;return o.replaceWith(...s.clone().nodes),void(e&&c(e,!r.noIsPseudoSelector))}if(y(o)){const e=o.parent;return o.replaceWith(...s.clone().nodes),void(e&&c(e,!r.noIsPseudoSelector))}if(m(o)){const e=o.parent;return o.replaceWith(...s.clone().nodes),void(e&&c(e,!r.noIsPseudoSelector))}const v=o.parent;r.noIsPseudoSelector?o.replaceWith(...s.clone().nodes):o.replaceWith(...i.clone().nodes),v&&c(v,!r.noIsPseudoSelector)})),i.push(o.toString())}}return i}function f(e){return"combinator"!==e.type&&!(e.parent&&e.parent.nodes.length>1)}function h(e,t=null){if(f(e))return!1;if(!e.parent)return!1;if(!!e.parent.nodes.find((e=>"combinator"===e.type||"comment"===e.type)))return!1;return!(!!e.parent.nodes.find((e=>"nesting"===e.type))&&t&&!h(t))}function y(e){if(!e.parent)return!1;if(0!==e.parent.nodes.indexOf(e))return!1;for(let t=1;t<e.parent.nodes.length;t++)if("combinator"===e.parent.nodes[t].type&&" "!==e.parent.nodes[t].value&&">"!==e.parent.nodes[t].value)return!1;return!0}function m(e){if(f(e))return!0;if(!e.parent)return!1;for(let t=0;t<e.parent.nodes.length;t++)if("nesting"!==!e.parent.nodes[t].type&&(e.parent.nodes[t].prev()||e.parent.nodes[t].next())){if(e.parent.nodes[t].prev()&&"combinator"!==e.parent.nodes[t].prev().type)return!1;if(e.parent.nodes[t].next()&&"combinator"!==e.parent.nodes[t].next().type)return!1}return!0}const g=e=>{let t=[],n="",r=!1,o=0,s=!1,a=!1;for(let c of e)a?a=!1:"\\"===c?a=!0:s?c===s&&(s=!1):'"'===c||"'"===c?s=c:"("===c?o+=1:")"===c?o>0&&(o-=1):0===o&&","===c&&(r=!0),r?(""!==n&&t.push(n.trim()),n="",r=!1):n+=c;return t.push(n.trim()),t};var b=["container","document","media","supports"];function v(e){const t=r(e);var o,s;e.params=(o=t.params,s=e.params,g(o).map((e=>g(s).map((t=>`${e} and ${t}`)).join(", "))).join(", ")),n(t)}function S(e,t){e.each((e=>{(e=>"rule"===e.type&&"rule"===Object(e.parent).type&&e.selectors.every((e=>0===e.trim().indexOf("&")&&-1===e.indexOf("|"))))(e)?function(e,t){const o=r(e);e.selectors=d(o.selectors,e.selectors,t),("rule"===e.type&&"rule"===o.type&&e.selector===o.selector||"atrule"===e.type&&"atrule"===o.type&&e.params===o.params)&&e.append(...o.nodes),n(o)}(e,t):(e=>"atrule"===e.type&&"nest"===e.name&&"rule"===Object(e.parent).type&&g(e.params).every((e=>e.split("&").length>=2&&-1===e.indexOf("|"))))(e)?function(e,t,o){const s=r(e),a=s.clone().removeAll().append(e.nodes);e.replaceWith(a),a.selectors=d(s.selectors,g(e.params),o),n(s),t(a,o)}(e,S,t):(e=>"atrule"===e.type&&b.includes(e.name)&&"rule"===Object(e.parent).type)(e)?function(e,t,o){const s=r(e),a=s.clone().removeAll().append(e.nodes);e.append(a),n(s),t(a,o)}(e,S,t):(e=>"atrule"===e.type&&b.includes(e.name)&&"atrule"===Object(e.parent).type&&e.name===e.parent.name)(e)&&v(e),Object(e.nodes).length&&S(e,t)}))}function W(e){const t=Object(e).noIsPseudoSelector||!1;return{postcssPlugin:"postcss-nesting",Rule(e){S(e,{noIsPseudoSelector:t})}}}W.postcss=!0,module.exports=W;
